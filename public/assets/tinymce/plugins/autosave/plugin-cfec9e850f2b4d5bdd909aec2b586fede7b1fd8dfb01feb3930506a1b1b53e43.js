!function(){var e={},t=function(t){for(var n=e[t],r=n.deps,a=n.defn,i=r.length,u=new Array(i),s=0;s<i;++s)u[s]=o(r[s]);var f=a.apply(null,u);if(void 0===f)throw"module ["+t+"] returned undefined";n.instance=f},n=function(t,n,o){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===o)throw"no definition function for "+t;e[t]={deps:n,defn:o,instance:void 0}},o=function(n){var o=e[n];if(void 0===o)throw"module ["+n+"] was undefined";return void 0===o.instance&&t(n),o.instance},r=function(e,t){for(var n=e.length,r=new Array(n),a=0;a<n;++a)r.push(o(e[a]));t.apply(null,t)};({}).bolt={module:{api:{define:n,require:r,demand:o}}};var a=n,i=function(e,t){a(e,[],function(){return t})};i("6",tinymce.util.Tools.resolve),a("1",["6"],function(e){return e("tinymce.EditorManager")}),a("2",["6"],function(e){return e("tinymce.PluginManager")}),a("3",["6"],function(e){return e("tinymce.util.LocalStorage")}),a("4",["6"],function(e){return e("tinymce.util.Tools")}),i("5",window),a("0",["1","2","3","4","5"],function(e,t,n,o,r){return e._beforeUnloadHandler=function(){var t;return o.each(e.editors,function(e){e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&e.getParam("autosave_ask_before_unload",!0)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t},t.add("autosave",function(t){function a(e,t){var n={s:1e3,m:6e4};return e=/^(\d+)([ms]?)$/.exec(""+(e||t)),(e[2]?n[e[2]]:1)*parseInt(e,10)}function i(){var e=parseInt(n.getItem(m+"time"),10)||0;return!((new Date).getTime()-e>p.autosave_retention&&(u(!1),1))}function u(e){n.removeItem(m+"draft"),n.removeItem(m+"time"),!1!==e&&t.fire("RemoveDraft")}function s(){!v()&&t.isDirty()&&(n.setItem(m+"draft",t.getContent({format:"raw",no_events:!0})),n.setItem(m+"time",(new Date).getTime()),t.fire("StoreDraft"))}function f(){i()&&(t.setContent(n.getItem(m+"draft"),{format:"raw"}),t.fire("RestoreDraft"))}function d(){g||(setInterval(function(){t.removed||s()},p.autosave_interval),g=!0)}function c(){var e=this;e.disabled(!i()),t.on("StoreDraft RestoreDraft RemoveDraft",function(){e.disabled(!i())}),d()}function l(){t.undoManager.beforeChange(),f(),u(),t.undoManager.add()}function v(e){var n=t.settings.forced_root_block;return""===(e=o.trim(void 0===e?t.getBody().innerHTML:e))||new RegExp("^<"+n+"[^>]*>((\xa0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+n+">|<br>$","i").test(e)}var m,g,p=t.settings;m=p.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",m=m.replace(/\{path\}/g,document.location.pathname),m=m.replace(/\{query\}/g,document.location.search),m=m.replace(/\{id\}/g,t.id),p.autosave_interval=a(p.autosave_interval,"30s"),p.autosave_retention=a(p.autosave_retention,"20m"),t.addButton("restoredraft",{title:"Restore last draft",onclick:l,onPostRender:c}),t.addMenuItem("restoredraft",{text:"Restore last draft",onclick:l,onPostRender:c,context:"file"}),!1!==t.settings.autosave_restore_when_empty&&(t.on("init",function(){i()&&v()&&f()}),t.on("saveContent",function(){u()})),r.onbeforeunload=e._beforeUnloadHandler,this.hasDraft=i,this.storeDraft=s,this.restoreDraft=f,this.removeDraft=u,this.isEmpty=v}),function(){}}),o("0")()}();